---
 layout: post
title: "Effetive"
subtitle: ""
author: "Fernando"
header-img: "img/post-bg-universe.jpg"
header-mask: 0.2
tags:
  - 
typora-copy-images-to: ..\img
---



程序运行时被读入内存, 不读入就无法运行. 



内存可以抽象成一个IC单元,  有着64位地址指的就是所有内存IC都是有64个地址引脚的. 



指针也是一种变量, 表示的不是数据的值, 而是存储着数据的地址.  32 位内存地址的环境中, 指针变量的长度是32位

不同数据类型的指针, 表示的是从指针存储的地址中一次能够读写的数据字节数





# 数组是内存的使用方法的基础, 因为 数组和内存的物理构造一模一样

1字节的数据类型(char)数组和内存的物理构造完全一致



基于数组的其他数据结构: 栈, 队列, 链表, 二叉查找树



队列一般是ring buffer的方式来实现的

BST是在链表的基础上添加了一个索引信息.





虚拟化内存: 把实际物理内存的内容, 和磁盘上虚拟内存的内容进行swap, 同时运行程序. 

虚拟化方法有 分页和分段 , windows 用的是分页 , 每页大小为4KB



节约内存的两种编程方法: 

1. 通过DLL文件实现函数公有, 全局只要有一个DLL文件, 所有EXE文件都可以调用, 这样运行时的多个应用程序同时使用这个动态库, 就可以节省不少的空间. 
2. 通过调用_stdcall 来减小程序文件的大小

> DLL文件内的函数, 基本都是__stdcall 的调用方式, 以节约内存. 
>
> C 语言特有的调用方式为C调用, 因为C对应的函数的传入参数是可变的. 因此函数调用方才知道函数的参数有多少个. 
>
> C中, 函数的返回值是通过register而不是stack来返回的. 
>
> 
>
>  通过栈来传递函数的参数, 







Windows 一个扇区有512字节, 软件逻辑上对磁盘进行读写的单位是cluster, 为sector的整数倍, 磁盘容量越大, cluster也越大

不同的文件不能 存储在同一个cluster中. 因此, cluster也是文件的最小存储单位. 





运行环境 = 操作系统+硬件

 source code 只是文本文件---> 经过编译成为**native code** --> Linker从**库文件**中抽取必要的目标文件, 结合到EXE文件中 ;  或者动态链接(在程序运行时链接的DLL**库文件**称为**导入库**)

在运行时, 程序动态申请分配的数据和对象创的内存区域称为**Heap堆**





# GCC编译 

`gcc `= 从最初的`GNU C Compiler `发展成了`GNU Complier Collection`

````sh
gcc test.c -o test
````

实质上，上述编译过程是分为四个阶段进行的，即预处理(也称预编译，Preprocessing)、编译(Compilation)、汇编 (Assembly)和连接(Linking)。

## 预处理(`Pre-Processing`): 

gcc的-E选项，可以让编译器在预处理后停止，并输出预处理结果。在本例中，预处理结果就是将stdio.h 文件中的内容插入到test.c中了。

```sh
gcc -E test.c -o test.i 
```

## 编译为汇编代码(`Compilation`)

```sh
gcc -S test.i -o test.s
```

## 汇编(`Assembly`) 

对于上一小节中生成的汇编代码文件test.s，gas汇编器负责将其编译为目标文件，如下：

```sh
gcc -c test.s -o test.o
```

## 连接(`Linking`)

链接: 把多个目标文件结合, 生成一个EXE文件

`gcc`连接器是`gas`提供的，负责将程序的目标文件与所需的所有附加的目标文件连接起来，最终生成可执行文件。附加的目标文件包括静态连接库和动态连接库。

对于上一小节中生成的`test.o`，将其与Ｃ标准输入输出库进行连接，最终生成程序test

```sh
gcc test.o -o test
```

在命令行窗口中，执行`./test`, 让它说HelloWorld吧！

Windows 中的目标文件不是存储在`.lib`文件中, 而是存储在DLL文件中, 整个编译过程如图所示:

![1553572777516](..\img\1553572777516.png)



# EXE是怎么运行的

EXE文件中, 变量和函数的内存地址, 每次都是不同的, 如何表示? > 给变量和函数分配虚拟的内存地址. 

运行时  **再配置信息** 会被追加到EXE文件头, 

